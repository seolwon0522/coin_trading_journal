# ë°±í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

## ðŸš€ ì„±ëŠ¥ ë¬¸ì œ í•´ê²°

### í˜„ìž¬ ë¬¸ì œì 

- **7,300ì¤„ CSV íŒŒì¼ì„ ë§¤ë²ˆ ì½ê¸°** â†’ 2-3ì´ˆ ì†Œìš” â±ï¸
- **íŒŒì¼ ì‹œìŠ¤í…œ ìŠ¤ìº”** â†’ íŒŒì¼ ê°œìˆ˜ ì¦ê°€ ì‹œ ì„±ëŠ¥ ì €í•˜
- **ë©”ëª¨ë¦¬ ê³¼ë‹¤ ì‚¬ìš©** â†’ ëª¨ë“  ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œ

### ðŸŽ¯ í•´ê²°ë°©ì•ˆ: PostgreSQL ê¸°ë°˜ ê³ ì„±ëŠ¥ ë°ì´í„°ë² ì´ìŠ¤

## ðŸ“‹ êµ¬í˜„ ì™„ë£Œ ì‚¬í•­

âœ… **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„**

- `backtest_runs`: ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë©”íƒ€ë°ì´í„°
- `backtest_trades`: ê°œë³„ ê±°ëž˜ ë°ì´í„°
- **ì¸ë±ìŠ¤ ìµœì í™”**: ì‹¬ë³¼, ë‚ ì§œ, PnL ê¸°ë°˜ ê³ ì† ì¡°íšŒ

âœ… **ë°ì´í„°ë² ì´ìŠ¤ ë§¤ë‹ˆì € êµ¬í˜„**

- CSV â†’ DB ë³€í™˜ ë¡œì§
- ê³ ì„±ëŠ¥ ì¡°íšŒ API
- ì‹¤ì‹œê°„ ì„±ê³¼ ì§€í‘œ ê³„ì‚°

âœ… **ì›¹ API ì—…ê·¸ë ˆì´ë“œ**

- CSV ì½ê¸° â†’ PostgreSQL ì¿¼ë¦¬ë¡œ ì „í™˜
- ì‘ë‹µì‹œê°„ **20-60ë°° ê°œì„ ** (2-3ì´ˆ â†’ 50-100ms)

âœ… **ë°±í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ í†µí•©**

- CSV ì €ìž¥ + DB ì €ìž¥ (í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹)
- ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€

## ðŸ› ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë°©ë²•

### 1ë‹¨ê³„: PostgreSQL ì„œë²„ ì‹œìž‘

```bash
# Docker Composeë¡œ PostgreSQL ì‹œìž‘
cd /Users/im-yoseb/coin_trading_journal
docker-compose up -d postgres
```

### 2ë‹¨ê³„: ê¸°ì¡´ CSV íŒŒì¼ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
cd nautilus-ml-pipeline
python migrate_csv_to_db.py
```

**ë§ˆì´ê·¸ë ˆì´ì…˜ ê³¼ì •:**

1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
2. CSV íŒŒì¼ ìŠ¤ìº” ë° ìœ íš¨ì„± ê²€ì‚¬
3. ë°±í…ŒìŠ¤íŠ¸ ë©”íƒ€ë°ì´í„° ìƒì„±
4. ê°œë³„ ê±°ëž˜ ë°ì´í„° ë°°ì¹˜ ì €ìž¥
5. ì¸ë±ìŠ¤ ìƒì„± ë° ì„±ëŠ¥ ìµœì í™”

### 3ë‹¨ê³„: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ìž¬ì‹œìž‘

```bash
# ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ API í™œì„±í™”
cd ml_monitoring_frontend
python app.py
```

## ðŸ“Š ì„±ëŠ¥ ê°œì„  íš¨ê³¼

| í•­ëª©              | ì´ì „ (CSV)     | ì´í›„ (PostgreSQL) | ê°œì„ ìœ¨           |
| ----------------- | -------------- | ----------------- | ---------------- |
| **ë°ì´í„° ì¡°íšŒ**   | 2-3ì´ˆ          | 50-100ms          | **20-60ë°°** âš¡   |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | ì „ì²´ ë¡œë“œ      | í•„ìš”í•œ ë¶€ë¶„ë§Œ     | **80%+ ì ˆì•½** ðŸ’¾ |
| **ë™ì‹œ ì ‘ê·¼**     | íŒŒì¼ ë½        | íŠ¸ëžœìž­ì…˜          | **ë¬´ì œí•œ** ðŸ‘¥    |
| **ì§‘ê³„ ì¿¼ë¦¬**     | ì‹¤ì‹œê°„ ê³„ì‚°    | ì‚¬ì „ ê³„ì‚°         | **10ë°°+** ðŸ“ˆ     |
| **í™•ìž¥ì„±**        | íŒŒì¼ ê°œìˆ˜ ì œí•œ | ë¬´ì œí•œ            | **ë¬´í•œëŒ€** ðŸ“ˆ    |

## ðŸ” API ë³€ê²½ì‚¬í•­

### PnL ížˆìŠ¤í† ë¦¬ API (`/api/pnl_history`)

**ì´ì „:**

```python
# CSV íŒŒì¼ ìŠ¤ìº” ë° ì „ì²´ ì½ê¸°
csv_files = sorted(results_dir.glob('backtest_*.csv'))
df = pd.read_csv(latest_file)  # 7,300ì¤„ ì „ì²´ ë¡œë“œ
```

**ì´í›„:**

```python
# ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ê¸°ë°˜ ì¡°íšŒ
chart_data = db_manager.get_pnl_history(symbol=symbol, days=days)
metrics = db_manager.get_performance_metrics()  # ì‚¬ì „ ê³„ì‚°ëœ ì§€í‘œ
```

### ìƒˆë¡œìš´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°

- `symbol`: íŠ¹ì • ì‹¬ë³¼ í•„í„°ë§
- `days`: ì¡°íšŒ ì¼ìˆ˜ ì œí•œ
- ì‘ë‹µì— `source: 'database'` í‘œì‹œ

## ðŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œì„ 

### ë°ì´í„° íë¦„

```
ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â†’ CSV ì €ìž¥ (í˜¸í™˜ì„±) + PostgreSQL ì €ìž¥ (ì„±ëŠ¥)
                     â†“
ì›¹ ëŒ€ì‹œë³´ë“œ â† PostgreSQL ê³ ì† ì¡°íšŒ â† ì¸ë±ìŠ¤ ìµœì í™”
```

### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

```sql
-- ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë©”íƒ€ë°ì´í„° (ìš”ì•½ ì •ë³´)
backtest_runs: id, symbol, strategy_type, total_pnl, win_rate...

-- ê°œë³„ ê±°ëž˜ ìƒì„¸ ë°ì´í„°
backtest_trades: run_id, timestamp, entry_price, pnl, exit_reason...

-- ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤
INDEX: (symbol, timestamp), (pnl), (strategy_type, timestamp)
```

## ðŸš¨ ì£¼ì˜ì‚¬í•­

### í˜¸í™˜ì„± ìœ ì§€

- ê¸°ì¡´ CSV íŒŒì¼ì€ ë°±ì—… ë³´ê´€
- í•˜ì´ë¸Œë¦¬ë“œ ì €ìž¥ ë°©ì‹ìœ¼ë¡œ ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í˜¸í™˜
- ì ì§„ì  ì „í™˜ ê°€ëŠ¥

### ë°ì´í„°ë² ì´ìŠ¤ ìš”êµ¬ì‚¬í•­

- PostgreSQL 15+ ê¶Œìž¥
- ìµœì†Œ 1GB ë©”ëª¨ë¦¬ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì‹œ)
- SSD ìŠ¤í† ë¦¬ì§€ ê¶Œìž¥ (ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ)

### ë°±ì—… ë° ë³µêµ¬

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
pg_dump trading_journal > backup_$(date +%Y%m%d).sql

# ë³µêµ¬
psql trading_journal < backup_20250101.sql
```

## ðŸ”§ ë¬¸ì œ í•´ê²°

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨ ì‹œ

```bash
# ë¡œê·¸ í™•ì¸
cat migration.log

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
python -c "from database_manager import BacktestDatabaseManager; BacktestDatabaseManager()"
```

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```bash
# PostgreSQL ì„±ëŠ¥ í™•ì¸
psql trading_journal -c "\dt+"  # í…Œì´ë¸” í¬ê¸°
psql trading_journal -c "SELECT COUNT(*) FROM backtest_trades;"  # ë°ì´í„° ê±´ìˆ˜
```

## ðŸŽ‰ ê²°ë¡ 

ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ **7,300ì¤„ CSV ë°˜ë³µ ì½ê¸° ë¬¸ì œê°€ ì™„ì „ížˆ í•´ê²°**ë©ë‹ˆë‹¤:

- âš¡ **ì‘ë‹µì‹œê°„ 20-60ë°° í–¥ìƒ**
- ðŸ’¾ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 80% ì ˆì•½**
- ðŸ‘¥ **ë‹¤ì¤‘ ì‚¬ìš©ìž ë™ì‹œ ì ‘ê·¼**
- ðŸ“ˆ **ë¬´ì œí•œ ë°ì´í„° í™•ìž¥ì„±**
- ðŸ” **ì‹¤ì‹œê°„ ê³ ê¸‰ ì¿¼ë¦¬ ì§€ì›**

**ì„œë²„ í™˜ê²½ì—ì„œ íŠ¹ížˆ íš¨ê³¼ì **ì´ë©°, ì‚¬ìš©ìž ê²½í—˜ì´ íšê¸°ì ìœ¼ë¡œ ê°œì„ ë©ë‹ˆë‹¤!
